
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Screen & Webcam Recorder</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#4f46e5" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: sans-serif; background-color: #1f2937; }
    #webcam { position: absolute; bottom: 20px; right: 20px; width: 150px; height: 150px; border-radius: 1rem; overflow: hidden; box-shadow: 0 0 10px rgba(0,0,0,0.5); display: none; z-index: 10; }
    #modalOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.75); display: flex; justify-content: center; align-items: center; z-index: 50; }
  </style>
</head>
<body class="text-white flex flex-col items-center justify-center min-h-screen">

  <div id="modalOverlay" class="hidden">
    <div class="bg-white text-black p-6 rounded-xl max-w-md text-center shadow-lg">
      <h2 class="text-xl font-bold mb-4">Important</h2>
      <p class="mb-4">To record your entire screen, please select <strong>"Entire Screen"</strong> in the next browser prompt.</p>
      <button id="proceedBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg">Proceed</button>
    </div>
  </div>

  <main class="w-full max-w-3xl px-4 py-8">
  <div class="flex justify-end mb-4">
    <button id="themeToggle" class="text-sm px-3 py-1 border border-gray-400 rounded">Toggle Theme</button>
  </div>
    <h1 class="text-2xl font-bold mb-4 text-center">Screen & Webcam Recorder</h1>

    <div class="aspect-video bg-black relative rounded-lg overflow-hidden">
      <video id="preview" class="w-full h-full object-contain" autoplay muted controls></video>
      <video id="webcam" autoplay muted class="circle"></video>
<div id="watermark" class="absolute top-2 left-2 text-xs bg-black bg-opacity-50 px-3 py-1 rounded text-white z-40 hidden">Your Signature</div>
<div id="smartTip" class="absolute bottom-2 left-2 text-xs bg-indigo-600 text-white px-3 py-1 rounded hidden z-40">Tip: Press ESC to stop screen share</div>

<div id="countdown" class="absolute inset-0 flex items-center justify-center text-white text-6xl font-bold bg-black bg-opacity-75 hidden z-50">3</div>
    </div>

    <div class="mt-6 flex flex-wrap gap-4 justify-center items-center">
<label class="flex items-center gap-2">
  <input type="checkbox" id="cleanUiToggle" />
  <span>Clean UI Mode</span>
</label>

      <label class="flex items-center gap-2">
        <input type="checkbox" id="shapeToggle" />
        <span>Rounded Webcam</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" id="micToggle" />
        <span>Record Microphone</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="checkbox" id="webcamToggle" />
        <span>Include Webcam</span>
      </label>
    </div>

    <div class="mt-6 flex flex-wrap gap-4 justify-center">
  <button id="pipBtn" class="bg-yellow-500 px-4 py-2 rounded text-black">Webcam PiP</button>
      <button id="startBtn" class="bg-indigo-600 px-6 py-2 rounded-lg">Start Recording</button>
      <button id="stopBtn" class="bg-red-600 px-6 py-2 rounded-lg" disabled>Stop</button>
    </div>

    <div id="downloadArea" class="mt-6 text-center hidden">
      <a id="downloadLink" class="bg-green-600 px-6 py-2 rounded-lg text-white">Download Recording</a>
    </div>

    <button id="helpBtn" class="block mx-auto mt-6 text-sm text-blue-400 underline">How to Use</button>
<div id="helpModal" class="fixed inset-0 bg-black bg-opacity-75 text-white p-8 hidden z-50 flex items-center justify-center">
  <div class="bg-gray-900 p-6 rounded max-w-lg w-full">
    <h2 class="text-xl font-bold mb-2">How to Use</h2>
    <ul class="list-disc pl-5 space-y-1 text-sm">
      <li>Click "Start Recording"</li>
      <li>Select "Entire Screen" to capture everything</li>
      <li>Toggle webcam/mic as needed</li>
      <li>Use PiP or Drawing tools if enabled</li>
    </ul>
    <button id="closeHelp" class="mt-4 bg-indigo-600 px-4 py-2 rounded">Close</button>
  </div>
</div>
<p class="text-xs text-gray-400 text-center mt-6">Your privacy is protected. Nothing is uploaded.</p>
  </main>

  <script>
    const preview = document.getElementById('preview');
    const webcam = document.getElementById('webcam');
    const webcamToggle = document.getElementById('webcamToggle');
    const micToggle = document.getElementById('micToggle');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const downloadLink = document.getElementById('downloadLink');
    const downloadArea = document.getElementById('downloadArea');
    const modalOverlay = document.getElementById('modalOverlay');
    const proceedBtn = document.getElementById('proceedBtn');

    let mediaRecorder;
    let chunks = [];
    let screenStream;
    let micStream;
    let camStream;

    proceedBtn.onclick = startRecording;

    startBtn.onclick = () => {
      modalOverlay.classList.remove('hidden');
    };

    async function async startRecording() {
      await showCountdown();
      modalOverlay.classList.add('hidden');
      chunks = [];
      downloadArea.classList.add('hidden');
      downloadLink.href = '';

      try {
        screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });

        if (micToggle.checked) {
          micStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        }

        if (webcamToggle.checked) {
          camStream = await navigator.mediaDevices.getUserMedia({ video: true });
          webcam.srcObject = camStream;
          webcam.style.display = 'block';
        }

        const streamTracks = [
          ...screenStream.getTracks(),
          ...(micStream ? micStream.getAudioTracks() : [])
        ];
        const mixedStream = new MediaStream(streamTracks);

        mediaRecorder = new MediaRecorder(mixedStream, { mimeType: 'video/webm; codecs=vp9' });
        mediaRecorder.ondataavailable = (e) => { if (e.data.size) chunks.push(e.data); };
        mediaRecorder.onstop = () => {
          const blob = new Blob(chunks, { type: 'video/webm' });
          const url = URL.createObjectURL(blob);
          preview.srcObject = null;
          preview.src = url;
          preview.muted = false;
          preview.play();
          downloadLink.href = url;
          downloadLink.download = "recording-" + new Date().toISOString().replace(/[:.]/g, '-') + ".webm";
          downloadArea.classList.remove('hidden');
        };

        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;

      } catch (err) {
        alert("Error: " + err.message);
        console.error(err);
      }
    }

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      screenStream.getTracks().forEach(t => t.stop());
      micStream?.getTracks().forEach(t => t.stop());
      camStream?.getTracks().forEach(t => t.stop());
      webcam.srcObject = null;
      webcam.style.display = 'none';
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.onclick = () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };
    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark');
    }

    // Webcam PiP
    const pipBtn = document.getElementById('pipBtn');
    pipBtn.onclick = async () => {
      if ('documentPictureInPicture' in window && webcam.srcObject) {
        try {
          await documentPictureInPicture.requestWindow(webcam);
        } catch (err) {
          alert('PiP not supported or already active.');
        }
      } else {
        alert('Your browser does not support Picture-in-Picture.');
      }
    };

    // Countdown timer
    const countdown = document.getElementById('countdown');
    async function showCountdown() {
      countdown.classList.remove('hidden');
      for (let i = 3; i > 0; i--) {
        countdown.textContent = i;
        await new Promise(r => setTimeout(r, 1000));
      }
      countdown.classList.add('hidden');
    }

    // Shape toggle
    document.getElementById('shapeToggle').onchange = (e) => {
      const isRounded = e.target.checked;
      webcam.classList.toggle('circle', isRounded);
      webcam.classList.toggle('square', !isRounded);
    };

    
    // Watermark overlay
    const watermark = document.getElementById('watermark');
    const smartTip = document.getElementById('smartTip');
    const cleanUiToggle = document.getElementById('cleanUiToggle');

    // Clean UI toggle
    cleanUiToggle.onchange = () => {
      const hide = cleanUiToggle.checked;
      document.querySelectorAll('header, button, label, #downloadArea').forEach(el => {
        el.style.display = hide ? 'none' : '';
      });
      watermark.classList.toggle('hidden', !hide);
      smartTip.classList.toggle('hidden', !hide);
    };

    // Help modal
    document.getElementById('helpBtn').onclick = () => {
      document.getElementById('helpModal').classList.remove('hidden');
    };
    document.getElementById('closeHelp').onclick = () => {
      document.getElementById('helpModal').classList.add('hidden');
    };

    // Register PWA service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
    // Register PWA service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(() => console.log('✅ Service Worker registered'))
    .catch(err => console.error('❌ Service Worker registration failed:', err));
}

  </script>
</body>
</html>